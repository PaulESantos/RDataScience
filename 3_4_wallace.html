<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Jamie Kass, Matt Aiello-Lammens" />


<title>Wallace</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="cm_yeti_bootswatch.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Ecology, Statistics, and Data Science with R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Head2_Schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R Intro
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Head1_CourseContent.html">About Course Content</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 1: Introduction to R</li>
    <li>
      <a href="00_CourseIntroductionFrame.html">1.0 Course Introduction</a>
    </li>
    <li>
      <a href="01_Rintro.html">1.1 First Steps</a>
    </li>
    <li>
      <a href="02_DataWrangling.html">1.2 Data Wrangling</a>
    </li>
    <li>
      <a href="03_Plotting.html">1.3 Plotting</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 2: Spatial Analyses</li>
    <li>
      <a href="04_Spatial.html">2.1 Spatial Data</a>
    </li>
    <li>
      <a href="05_Raster.html">2.2 Spatial Raster Data</a>
    </li>
    <li>
      <a href="06_RasterTwo.html">2.3 More Raster Data</a>
    </li>
    <li class="divider"></li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Ecoinformatics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="3_1_Ecoinf_Schedule.html">0 Workshop Schedule</a>
    </li>
    <li>
      <a href="3_8_BIEN_intro.html">1 (BIEN) Botanical Information and Ecology Network</a>
    </li>
    <li>
      <a href="3_7_TNRS.html">2 Taxonomic Name Resolution</a>
    </li>
    <li>
      <a href="3_3_RBIEN_tutorial.html">3 Accessing Plant Biodiversity Data</a>
    </li>
    <li>
      <a href="3_4_wallace.html">4 A streamlined modeling workflow: Wallace</a>
    </li>
    <li>
      <a href="3_5_Minxent.html">5 Integrating biogeographic data </a>
    </li>
    <li>
      <a href="3_2_Networks.html">6 Network Associations</a>
    </li>
    <li>
      <a href="3_6_Teaching_Ecoinformatics.html">7 Teaching Econformatics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Ecological Modeling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Under_Construction.html">Under Construction</a>
    </li>
  </ul>
</li>
<li>
  <a href="Head3_Resources.html">Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/cmerow/RDataScience/tree/gh-pages">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Wallace</h1>
<h4 class="author"><em>Jamie Kass, Matt Aiello-Lammens</em></h4>

</div>


<!-- Scroll down to the section beginning # *Wallace* below - this top stuff is just for the website  -->
<div>
<object data="3_4_assets/Wallace_Intro.pdf" type="application/pdf" width="100%" height="650px">
<p>
It appears you don’t have a PDF plugin for this browser. No biggie… you can <a href="3_4_assets/Wallace_Intro.pdf">click here to download the PDF file.</a>
</p>
</object>
</div>
<p>
<a href="3_4_assets/Wallace_Intro.pdf">Download the PDF of the presentation</a>
</p>
<!-- [<i class="fa fa-file-code-o fa-3x" aria-hidden="true"></i> The R Script associated with this page is available here](3_4_wallace.R).  Download this file and open it (or copy-paste into a new script) with RStudio so you can follow along.   -->
<p>
<a href="3_4_wallace_Rmd">Download the Rmd of the code</a>
</p>
<div id="wallace" class="section level1">
<h1><span class="header-section-number">1</span> <em>Wallace</em></h1>
<p><em>Wallace</em> is a modular platform for reproducible modeling of species niches and distributions, written in R with the web app development package <code>shiny</code>. The application guides users through a complete analysis, from the acquisition of data to visualizing model predictions on an interactive map, thus bundling complex workflows into a single, streamlined interface. Please find the <em>Wallace</em> homepage below. It has links to the development page (Github repository), the official <em>Wallace</em> email, and the <em>Wallace</em> Google Group for discussion and support for the software.</p>
<p><a href="https://wallaceecomod.github.io/" class="uri">https://wallaceecomod.github.io/</a></p>
<p><em>Wallace</em> is currently available for installation via the Github development page. You can get <em>Wallace</em> up and running with a few lines of code.</p>
<pre class="r"><code># if you do not have devtools installed, install it first
install.packages(&quot;devtools&quot;, repos = &quot;http://cran.us.r-project.org&quot;)
# install wallace from github
devtools::install_github(&quot;wallaceEcoMod/wallace&quot;)
# load wallace
library(wallace)
# run the user interface
wallace()</code></pre>
<p>While the above will get you going, if you want to use the <strong><em>Maxent</em></strong> module in Component <strong>Model</strong>, you’ll have to follow a few more steps, which are listed in the documentation at the bottom (i.e., the <code>README.md</code> file) of <a href="https://github.com/wallaceEcoMod/wallace">the Github repository page</a>.</p>
</div>
<div id="wallace-is-modular" class="section level1">
<h1><span class="header-section-number">2</span> <em>Wallace</em> is <strong>Modular</strong></h1>
<p>Developers can (and are encouraged to) contribute new methods to <em>Wallace</em> by submitting pull requests for new modules. This feature is key to the concept of <em>Wallace</em>, which was built for community expansion.</p>
<p>The way developers can do this may change in future versions, but we will provide a simple example of adding a module in the current framework.</p>
</div>
<div id="architecture-of-wallace" class="section level1">
<h1><span class="header-section-number">3</span> Architecture of <em>Wallace</em></h1>
<p><em>Wallace</em> currently has eight “components” that represent key steps of a niche/distributional modeling analysis. Within each component, there are a number of “modules”, which represent methodological options for that particular step. For example, the sixth component <strong>Model</strong> has modules <strong><em>BIOCLIM</em></strong> and <strong><em>Maxent</em></strong>.</p>
<p>For all <code>shiny</code> apps, there are two main parts: “ui” and “server”. The UI part generates all the controls and displays of the user interface, while the server part runs all the functions in the background.</p>
<p>Within the <code>inst/shiny</code> folder, <em>Wallace</em> has a script for each part: <code>server.R</code> and <code>ui.R</code>. In addition, there are scripts that contain the modules for each component in <code>/modules</code>. These are <code>source()</code>ed in <code>server.R</code>. Adding a new module involves making edits to each of these scripts, as you’ll need to add not only the functionality, but the buttons, check boxes, maps, tables, etc. that the user interacts with and views.</p>
</div>
<div id="example-workflow" class="section level1">
<h1><span class="header-section-number">4</span> Example workflow</h1>
<p>Before getting into how to expand <em>Wallace</em>, let’s work our way through an example workflow. If you have successfully installed <em>Wallace</em> then please follow along, or feel free to ignore us and try things out yourself. If you haven’t been able to get the install to work, then follow us as we go through it in front, and come talk with Jamie or Matt after the workshop. We’ll try to help troubleshoot your installation problems.</p>
</div>
<div id="workflow-demo" class="section level1">
<h1><span class="header-section-number">5</span> <strong>WORKFLOW DEMO</strong></h1>
</div>
<div id="using-the-resulting-.rmd-file-to-reproduce-and-customize-analyses" class="section level1">
<h1><span class="header-section-number">6</span> Using the resulting <code>*.Rmd</code> file to reproduce and customize analyses</h1>
<p>At any point during the <em>Wallace</em> workflow, users can download a document detailing the session analysis with text and R code. There are multiple formats available, but the <a href="http://rmarkdown.rstudio.com/">RMarkdown</a> format (i.e., <code>*.Rmd</code>) can be run like a script to reproduce the analysis. Users can directly edit this file to customize parts of the analysis that are outside the scope of what <em>Wallace</em> can (currently) do. The other formats (.html, .pdf, .doc) are not executable, but can be shared with colleagues or used for supplemental information for publications, etc.</p>
</div>
<div id="customize-.rmd-demo" class="section level1">
<h1><span class="header-section-number">7</span> **CUSTOMIZE *.RMD DEMO**</h1>
<div id="using-gams-for-modeling" class="section level2">
<h2><span class="header-section-number">7.1</span> Using GAMs for modeling</h2>
<p>As an example of the utility of the <code>*.Rmd</code> format, let’s imagine that you want to use a <strong>generalized addative model</strong> as an additional SDM approach. Looking through the <code>*.Rmd</code> file, we can find the <strong>code chunk</strong> (in the parlance of RMarkdown, a block of code embedded within the text) where we run our SDM, and add a new code chunk to run a GAM (and preferably, some text explaining what you’re doing for reference).</p>
</div>
</div>
<div id="lets-add-gams-to-wallace" class="section level1">
<h1><span class="header-section-number">8</span> Let’s add GAMs to <em>Wallace</em></h1>
<p>Say that for your particular research needs, you’d like to use GAMs in the <em>Wallace</em> GUI, and possibly compare the results with the other models you can build and evaluate with <em>Wallace</em>.</p>
<p>You’ll be working in <code>mods_comp6.R</code>, <code>server.R</code>, and <code>ui.R</code>. Let’s start with the functionality for the UI.</p>
<div id="ui-development" class="section level2">
<h2><span class="header-section-number">8.1</span> UI development</h2>
<p>To start, you’ll need to imagine what the user will need to input to <em>Wallace</em> in order to have your module work. In the case of GAMs (the simplest case), perhaps you envision users entering the variables that go into the model and specifying a smoothing parameter to apply to all variables.</p>
<p>Open up <code>ui.R</code> and use the navigation tab in RStudio (lower left corner of script window) to find “tab 6”, which is the UI functionality for Component <strong>Model</strong>. We’ll need to edit some parts of this code to accomodate a new modeling method.</p>
<p>Each component is nested in a <code>conditonalPanel()</code> block, which activates only after a conditional statement is fulfilled. In this case, the condition is whether the component tab is selected or not.</p>
<p><strong>IMPORTANT</strong> Make sure to add commas after all <code>shiny</code> functions within a <code>conditionalPanel()</code> block. Reference the code in <code>ui.R</code> for the appropriate syntax.</p>
<pre class="r"><code># First, we add &quot;GAM&quot; to the choices for the radio buttons use to select the modeling method (around line 260)
radioButtons(&quot;enmSel&quot;, &quot;Modules Available:&quot;, 
             choices = list(&quot;BIOCLIM&quot;, &quot;Maxent&quot;, &quot;GAM&quot;))

# Next, we&#39;ll add functionality specific to GAMs: put a set of checkboxes to specify variables
# that go into the model (&quot;gamVars&quot;), and numeric input for the smoothing parameter (&quot;gamDF&quot;).
# The function uiOutput() generates ui that is defined in server.R -- we&#39;ll see this next.
# (around line 295)
conditionalPanel(&quot;input.enmSel == &#39;GAM&#39;&quot;,
                 uiOutput(&#39;gamVars&#39;),
                 numericInput(&#39;gamDF&#39;, label = &quot;Smoothing parameter&quot;, value = 4))

# Lastly, add GAMs to the conditional statement that generates the button that runs the models
# (around line 300)
conditionalPanel(&quot;input.enmSel == &#39;BIOCLIM&#39; || input.enmSel == &#39;Maxent&#39; || input.enmSel == &#39;GAM&#39;&quot;,
                 strong(&quot;Build and evaluate models&quot;), br(),
                 actionButton(&quot;goEval&quot;, &quot;Run Models&quot;), br(), br(),
                 downloadButton(&#39;downloadEvalcsv&#39;, &quot;Download Results CSV&quot;))</code></pre>
<p>Now let’s add the checkbox input ui and gam module function call to <code>server.R</code>. The checkbox input is specified here because it needs the names of the variables integrated into the the workflow in Component <strong>Obtain Environmental Data</strong>, and the information can only be passed on the server side.</p>
<pre class="r"><code># Define the uiOutput (ui side) with a renderUI() function (server side). This is executed within an observe() because it&#39;s a reactive function (see shiny documentation for more details). (around line 452)
observe({
  output$gamVars &lt;- renderUI({
    if (is.null(values$preds)) return()
    n &lt;- names(values$preds)
    predNameList &lt;- setNames(as.list(n), n)
    checkboxGroupInput(&quot;gamVars&quot;, label = &quot;Select variables&quot;,
                       choices = predNameList)
  })
})

# Then we need to add the function that runs the GAMs. This goes at the end of the observeEvent() for the goEval button specified in ui.R. (around line 492)
observeEvent(input$goEval, {
  ...
  else if (input$enmSel == &#39;GAM&#39;) {
    comp6_gamMod(input$gamVars, input$gamDF)
  }
}</code></pre>
<p>Finally, we will write the function to run the GAMs and plot a results table in the “Results” tab in <code>mods_comp6.R</code>.</p>
<pre class="r"><code>comp6_gamMod &lt;- function(gamVars, gamDF) {

  # take the list of variables input and turn it into a formula with all variable names
  # wrapped in s() with degrees of freedom equal to gamDF
  dfs &lt;- unlist(lapply(gamVars, FUN = function(x) paste0(&quot;s(&quot;, x, &quot;, &quot;, gamDF, &quot;)&quot;)))
  f &lt;- as.formula(paste(&quot;pa&quot;, paste(dfs, collapse = &quot; + &quot;), sep = &quot; ~ &quot;))

  # extract the predictor variables values at occurrence and background points
  occ.x &lt;- raster::extract(values$preds[[gamVars]], values$modParams$occ.pts)
  bg.x &lt;- raster::extract(values$preds[[gamVars]], values$modParams$bg.pts)
  # rbind them together and make new field for identifying occurrence from background
  x &lt;- rbind(occ.x, bg.x)
  gamData &lt;- data.frame(pa=c(rep(1, nrow(values$modParams$occ.pts)), rep(0, nrow(values$modParams$bg.pts))), x)

  # run the GAM
  res &lt;- gam(f, family = &quot;binomial&quot;, data = gamData)
  # put a copy of the output in the reactiveValues list to retrieve later
  values$gamOut &lt;- res

  # print summary table to Results tab
  output$evalTbl &lt;- DT::renderDataTable({DT::datatable(data.frame(variable=gamVars, coefficient=res$coefficients[-1], row.names=NULL))})

  # write log
  writeLog(paste(&quot;&gt; GAM ran successfully.&quot;))
}</code></pre>
</div>
</div>
<div id="congratulations" class="section level1">
<h1><span class="header-section-number">9</span> Congratulations</h1>
<p>You’ve added a module. The module building process will likely require testing and troubleshooting, but referencing other functional modules will give you tips on how to make everything work the way you want it to.</p>
<p>If you’ve built a functional model and you think it’s neat, please submit a pull request so that the <em>Wallace</em> team can consider adding it to the official version. You can also make your own versions of <em>Wallace</em> as you see fit – it’s open and free (license GPL3). Hope you enjoyed this short tutorial.</p>
</div>


<!-- give the footer some space -->
<br/>
<br/>

<footer id="site-footer">
  <div id="footer1">
  <a href="https://cmerow.github.io"><img src="img/cory.png" alt="logo" width=40px></a>
  <!--
  <a href="http://adamwilson.us/#contact"><i class="fa fa-envelope fa-2x"></i></a> 
  <a href="https://twitter.com/AdamWilsonLab"><i class="fa fa-twitter fa-2x"></i></a> 
  <a href="https://github.com/AdamMWilson"><i class="fa fa-github fa-2x"></i></a>
  -->
  </div>
  <div id="footer2">
  <a rel="license" property="http://creativecommons.org/ns#license"
  href="http://creativecommons.org/licenses/by/4.0/" ><img src="img/cc-by.svg" alt="cc-by"/></a> 
  </div>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
