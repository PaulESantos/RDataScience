<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Cory Merow" />


<title>Introduction to Integral Projection Models</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="cm_yeti_bootswatch.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Ecology, Statistics, and Data Science with R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Head2_Schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R Intro
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Head1_CourseContent.html">About Course Content</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 1: Introduction to R</li>
    <li>
      <a href="00_CourseIntroductionFrame.html">1.0 Course Introduction</a>
    </li>
    <li>
      <a href="01_Rintro.html">1.1 First Steps</a>
    </li>
    <li>
      <a href="02_DataWrangling.html">1.2 Data Wrangling</a>
    </li>
    <li>
      <a href="03_Plotting.html">1.3 Plotting</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 2: Spatial Analyses</li>
    <li>
      <a href="04_Spatial.html">2.1 Spatial Data</a>
    </li>
    <li>
      <a href="05_Raster.html">2.2 Spatial Raster Data</a>
    </li>
    <li>
      <a href="06_RasterTwo.html">2.3 More Raster Data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 3: Reproducible and Interactive Research</li>
    <li>
      <a href="07_Reproducible.html">3.1 Research Reports with R markdown</a>
    </li>
    <li>
      <a href="11_Git.html">3.2 Version control with Github</a>
    </li>
    <li>
      <a href="07_03_RMarkdown_Tools.html">3.3 RMarkdown Tools: Interactive Presentations, Apps, Websites</a>
    </li>
    <li class="divider"></li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Ecological Modeling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="101SDMs.html">Introduction to Species Distribution Models</a>
    </li>
    <li>
      <a href="4_1_Wallace_SDMs.html">Range Models with Wallace</a>
    </li>
    <li>
      <a href="20_Intro_Demography.html">Introduction to Demography</a>
    </li>
    <li>
      <a href="21_Intro_IPMs.html">Introduction to Integral Projection Models</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Ecoinformatics Workshop</li>
    <li>
      <a href="3_1_Ecoinf_Schedule.html">0 Workshop Schedule</a>
    </li>
    <li>
      <a href="3_8_BIEN_intro.html">1 (BIEN) Botanical Information and Ecology Network</a>
    </li>
    <li>
      <a href="3_7_TNRS.html">2 Taxonomic Name Resolution</a>
    </li>
    <li>
      <a href="3_3_RBIEN_tutorial.html">3 Accessing Plant Biodiversity Data</a>
    </li>
    <li>
      <a href="3_4_wallace.html">4 A streamlined modeling workflow: Wallace</a>
    </li>
    <li>
      <a href="3_5_Minxent.html">5 Integrating biogeographic data </a>
    </li>
    <li>
      <a href="3_2_Networks.html">6 Network Associations</a>
    </li>
    <li>
      <a href="3_6_Teaching_Ecoinformatics.html">7 Teaching Econformatics</a>
    </li>
  </ul>
</li>
<li>
  <a href="Head3_Resources.html">Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/cmerow/RDataScience/tree/gh-pages">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Introduction to Integral Projection Models</h1>
<h4 class="author"><em>Cory Merow</em></h4>
<h4 class="date"><em>10/5/2017</em></h4>

</div>


<blockquote>
<p>This tutorial gives a practical overview of building stage-structured (e.g. size, age) population models use integral projection models.</p>
</blockquote>
<div>
<object data="21_assets/Intro_to_IPMs_short.pdf" type="application/pdf" width="100%" height="650px">
<p>
It appears you don’t have a PDF plugin for this browser. No biggie… you can <a href="21_assets/Intro_to_IPMs_short.pdf">click here to download the PDF file.</a>
</p>
</object>
</div>
<p>
<a href="21_assets/Intro_to_IPMs_short.pdf">Download the PDF of the presentation</a>
</p>
<!-- [<i class="fa fa-file-code-o fa-3x" aria-hidden="true"></i> The R Script associated with this page is available here](21_Intro_IPMs.R).  Download this file and open it (or copy-paste into a new script) with RStudio so you can follow along.   -->
<p>The R Script associated with this page is available</p>
<p>
<a href="21_assets/Exercises/Intro_to_IPMs_Exercises.r">here</a>
</p>
<div id="introductory-ipm-exercises" class="section level1">
<h1><span class="header-section-number">1</span> Introductory IPM exercises</h1>
<p>Here, we introduce a simple IPM for a the long-lived alpine perennial plant Dracocephalum austriacum. The analyses minimize the complexity of the R code in order to make the model transparent. We calculate basic population statistics, including population growth rate, sensitivity, elasticity, and passage times throughout to check the plausibility of the model.</p>
<p>The document is organized as follows</p>
<ol style="list-style-type: decimal">
<li>plots for data exploration</li>
<li>parameter estimation for regressions</li>
<li>build vital rate functions</li>
<li>make a kernel</li>
<li>basic analyses</li>
</ol>
<!-- ```{r} -->
<!--    # set up directory structure. we'll place a temp folder on your desktop to store some plots -->
<!-- # if(!file.exists('~/Desktop/Temp_IPM_output')) dir.create('~/Desktop/Temp_IPM_output') -->
<!--    # set this as the working directory -->
<!-- # setwd('~/Desktop/Temp_IPM_output')  -->
<!-- ``` -->
<p><br></p>
<hr />
<p><br></p>
</div>
<div id="data-exploration" class="section level1">
<h1><span class="header-section-number">2</span> Data exploration</h1>
<p>To read in the data you’ll have to set your own file path here.</p>
<p>
<a href="21_assets/Exercises/Intro_to_IPMs_Exercises_Data.csv">Download the data csv</a>
</p>
<pre class="r"><code>d=read.csv(&#39;21_assets/Exercises/Intro_to_IPMs_Exercises_Data.csv&#39;)</code></pre>
<p>You’ll notice that adults are stored at the beginning of the data set with values for size (measured in 2001) and sizeNext (measured in 2002). the number of seeds and flowering status were measured in 2001.</p>
<pre class="r"><code>head(d)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["size"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["sizeNext"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["surv"],"name":[3],"type":["int"],"align":["right"]},{"label":["fec.seed"],"name":[4],"type":["int"],"align":["right"]},{"label":["fec.flower"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"3.09","2":"NA","3":"0","4":"NA","5":"NA"},{"1":"2.81","2":"NA","3":"0","4":"NA","5":"NA"},{"1":"4.46","2":"6.07","3":"1","4":"15","5":"1"},{"1":"1.68","2":"NA","3":"0","4":"NA","5":"NA"},{"1":"3.99","2":"NA","3":"0","4":"NA","5":"NA"},{"1":"4.07","2":"NA","3":"0","4":"NA","5":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>New recruits are stored at the end and were only observed in the second survey (2002). Hence their size value is NA and sizeNext value is an integer.</p>
<pre class="r"><code>tail(d)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["size"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["sizeNext"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["surv"],"name":[3],"type":["int"],"align":["right"]},{"label":["fec.seed"],"name":[4],"type":["int"],"align":["right"]},{"label":["fec.flower"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"NA","2":"1.78","3":"NA","4":"NA","5":"NA"},{"1":"NA","2":"1.01","3":"NA","4":"NA","5":"NA"},{"1":"NA","2":"1.68","3":"NA","4":"NA","5":"NA"},{"1":"NA","2":"1.44","3":"NA","4":"NA","5":"NA"},{"1":"NA","2":"1.08","3":"NA","4":"NA","5":"NA"},{"1":"NA","2":"1.62","3":"NA","4":"NA","5":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>    # make some plots -  figure 1
par(mfrow=c(2,2),mar=c(4,4,2,1))
plot(d$size,jitter(d$surv),main=&#39;Survival&#39;) # jittered to see easier
plot(d$size,d$sizeNext,main=&#39;Growth/Shrinkage/Stasis&#39;)  
plot(d$size,d$fec.seed,main=&#39;Seeds&#39;) # jittered to see easier
hist(d$sizeNext[is.na(d$size)],main=&#39;Size of Recruits&#39;)</code></pre>
<p><img src="21_Intro_IPMs_files/figure-html/unnamed-chunk-5-1.png" /><!-- --></p>
<p>Note that we use NAs for missing or non-applicable data rather than 0 or some other indicator because this causes them to be automatically excluded from r’s regression functions.</p>
<p>The model we’ll build takes the general form (note that equations may not render in all browsers)</p>
<p>$ n[z’,t+1]= $</p>
<p>where z’ is size at time t+1 and z is size at time t. P is the growth/survival kernel and F is the fecundity kernel. these will be decomposed further as:</p>
<p>$ P[z’,z]=growth[z’,z] * survival[z] $</p>
<p>$ F[z’,z]=floweringProbability[z] * seedsPerIndividual[z] * establishmentProbability * recruitSize[z’] $</p>
<p>We’ll begin building the regressions for each of these vital rates in the next section.</p>
<p><br></p>
<hr />
<p><br></p>
</div>
<div id="regressions-for-vital-rate-functions" class="section level1">
<h1><span class="header-section-number">3</span> Regressions for vital rate functions</h1>
<pre class="r"><code># 0. set up parameter list for regressions
    # this sets up a list of the model parameters. these parameters will be estimated and recorded below.
params=data.frame(
    surv.int=NA,
    surv.slope=NA,
    growth.int=NA,
    growth.slope=NA,
    growth.sd=NA,
    seed.int=NA,
    seed.slope=NA,
    recruit.size.mean=NA,
    recruit.size.sd=NA,
    establishment.prob=NA
)

# 1. survival regression
surv.reg=glm(surv~size,data=d,family=binomial())
summary(surv.reg)</code></pre>
<pre><code>## 
## Call:
## glm(formula = surv ~ size, family = binomial(), data = d)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.2275  -0.5815   0.2491   0.5597   2.0972  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -3.9646     0.4760  -8.329   &lt;2e-16 ***
## size          1.2897     0.1338   9.642   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 488.69  on 399  degrees of freedom
## Residual deviance: 315.82  on 398  degrees of freedom
##   (100 observations deleted due to missingness)
## AIC: 319.82
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>params$surv.int=coefficients(surv.reg)[1]
params$surv.slope=coefficients(surv.reg)[2]

# 2. growth regression
growth.reg=lm(sizeNext~size,data=d)
summary(growth.reg)</code></pre>
<pre><code>## 
## Call:
## lm(formula = sizeNext ~ size, data = d)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.8037 -0.5434  0.0932  0.5741  2.6732 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  2.68135    0.19580   13.69   &lt;2e-16 ***
## size         0.57922    0.03902   14.84   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.8866 on 278 degrees of freedom
##   (220 observations deleted due to missingness)
## Multiple R-squared:  0.4421, Adjusted R-squared:  0.4401 
## F-statistic: 220.3 on 1 and 278 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>params$growth.int=coefficients(growth.reg)[1]
params$growth.slope=coefficients(growth.reg)[2]
params$growth.sd=sd(resid(growth.reg))</code></pre>
<pre class="r"><code># 3. seeds regression
# note that we are just pooling all individuals into this regression regardless of whether they flowered or not. a later exercise will be to explicitly model flowering probability. i.e. for the moment we&#39;re taking floweringProbability[z]=1.
seed.reg=glm(fec.seed~size,data=d,family=poisson())
summary(seed.reg)</code></pre>
<pre><code>## 
## Call:
## glm(formula = fec.seed ~ size, family = poisson(), data = d)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -6.5338  -1.8830   0.0529   1.5375   4.9690  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.33234    0.06370   20.92   &lt;2e-16 ***
## size         0.30647    0.01164   26.34   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 2598.3  on 279  degrees of freedom
## Residual deviance: 1840.1  on 278  degrees of freedom
##   (220 observations deleted due to missingness)
## AIC: 2942.2
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<pre class="r"><code>params$seed.int=coefficients(seed.reg)[1]
params$seed.slope=coefficients(seed.reg)[2]

# 4. size distribution of recruits
    # in the dataframe, recruits are those individuals who have a value for sizeNext but not for size
params$recruit.size.mean=mean(d$sizeNext[is.na(d$size)])
params$recruit.size.sd=sd(d$sizeNext[is.na(d$size)])

# 5. establishment probability
    # these data represent a single year&#39;s worth of data, hence establishment probability can be estimated by dividing the number of observed recruits by the number of seeds. hence the growth/survival measurements were taken in year t which the recruit sizes were measured in year t+1.
params$establishment.prob=sum(is.na(d$size))/sum(d$fec.seed,na.rm=TRUE)

# 6. plot the models over the data - figure 2
par(mfrow=c(2,2),mar=c(4,4,2,1))
xx=seq(0,8,by=.01)
plot(d$size,d$sizeNext,main=&#39;Growth/Shrinkage/Stasis&#39;)  
    lines(xx,predict(growth.reg,data.frame(size=xx)),col=&#39;red&#39;,lwd=3)
plot(d$size,jitter(d$surv),main=&#39;Survival&#39;) # jittered to see easier
    lines(xx,predict(surv.reg,data.frame(size=xx),type=&#39;response&#39;), col=&#39;red&#39;,lwd=3)
plot(d$size,d$fec.seed,main=&#39;Seeds&#39;) # jittered to see easier
    lines(xx,predict(seed.reg,data.frame(size=xx),type=&#39;response&#39;), col=&#39;red&#39;,lwd=3)
hist(d$sizeNext[is.na(d$size)],main=&#39;Size of Recruits&#39;,freq=FALSE)
    lines(xx,dnorm(xx,params$recruit.size.mean,params$recruit.size.sd), col=&#39;red&#39;,lwd=3)</code></pre>
<p><img src="21_Intro_IPMs_files/figure-html/unnamed-chunk-7-1.png" /><!-- --></p>
<p><br></p>
<hr />
<p><br></p>
</div>
<div id="build-vital-rate-functions" class="section level1">
<h1><span class="header-section-number">4</span> Build vital rate functions</h1>
<p>Each of the functions below represents one or more of the vital rates. these functions are used to build the IPM and use output (the coefficients) from the regressions developed above.</p>
<p>These functions represent the modeler’s decision about how to decompose the life cycle. in this very simple example, we model (1) survival, (2) growth, (3) seed number, (4) the seedling size distribution and (5) the establishment probability. these last three functions are combined in the model for fecundity below. in practice, we’d need to decide what regressions to build in part B in advance, but it’s easier to digest this section after you’ve seen the regressions above, so fortunately we built all the right regressions already. in practice, sections B and C are iterative one might inform one another.</p>
<pre class="r"><code>## vital rate functions

# 1. probability of surviving
# this is a logistic funcion
s.x=function(x,params) {
    u=exp(params$surv.int+params$surv.slope*x)
    return(u/(1+u))
}

# 2. growth function
# this is a normal distribution
g.yx=function(xp,x,params) {            
    dnorm(xp,mean=params$growth.int+params$growth.slope*x,sd=params$growth.sd)
}

# 3. reproduction function      
# this is a constant times a normal distribution times an exponential function
f.yx=function(xp,x,params) {        
    params$establishment.prob*
    dnorm(xp,mean=params$recruit.size.mean,sd=params$recruit.size.sd)*
    exp(params$seed.int+params$seed.slope*x)
}</code></pre>
<p><br></p>
<hr />
<p><br></p>
</div>
<div id="make-a-kernel" class="section level1">
<h1><span class="header-section-number">5</span> Make a kernel</h1>
<p>In this section, we combine the vital rate functions to build the discretized IPM kernel, which we’ll call the IPM matrix (e.g. shown in Fig. 2c in the main text). To integrate, we begin by defining the boundary points (b; the edges of the cells defining the matrix), mesh points (y; the centers of the cells defining the matrix and the points at which the matrix is evaluated for the midpoint rule of numerical integration), and step size (h; the widths of the cells). The integration limits (min.size and max.size) span the range of sizes observed in the data set, and then some.</p>
<pre class="r"><code># 1. boundary points b, mesh points y and step size h
    # integration limits - these limits span the range of sizes observed in the data set, and then some.
min.size=.9*min(c(d$size,d$sizeNext),na.rm=T)
max.size=1.1*max(c(d$size,d$sizeNext),na.rm=T)
    # number of cells in the discretized kernel
n=100 
    # boundary points (the edges of the cells defining the kernel)
b=min.size+c(0:n)*(max.size-min.size)/n 
# mesh points (midpoints of the cells)
y=0.5*(b[1:n]+b[2:(n+1)])
# width of the cells
h=y[2]-y[1]</code></pre>
<p>Next, we make the IPM matrices. The function outer() evaluates the matrix at all pairwise combinations of the two vectors y and y and returns matrices representing the kernel components for growth and fecundity, respectively. For the numerical integration, we’re using the midpoint rule (the simplest option) to estimate the area under a curve. The midpoint rule assumes a rectangular approximation. The heights of the rectangles are given by the outer function and the width of the rectangles is h.</p>
<pre class="r"><code># 2. make component kernels
par(mfrow=c(2,3)) 

G=h*outer(y,y,g.yx,params=params)   # growth kernel
image(y,y,t(G),main=&#39;growth kernel&#39;)        # plot it

S=s.x(y,params=params)                          # survival 
plot(y,S,type=&#39;l&#39;,main=&#39;survival&#39;)  # plot it

P=G                                                                 # placeholder;redefine P on the next line
for(i in 1:n) P[,i]=G[,i]*S[i]          # growth/survival kernel
image(y,y,t(P),main=&#39;survival/growth kernel&#39;)   # plot it
abline(0,1,lwd=3)                                       # plot 1:1, which represents stasis

F=h*outer(y,y,f.yx,params=params)   # reproduction kernel
image(y,y,t(F),main=&#39;fecundity kernel&#39;) # plot it

K=P+F                                                           # full kernel
image(y,y,t(K),main=&#39;full kernel&#39;)          # plot it

# sometimes it&#39;s hard to see both the fecundity part of the kernel swamps the growth/survival part, so here&#39;s a plotting trick to level out the kernel
image(y,y,t(K)^.3,main=&#39;full kernel^0.3&#39;)           # plot it</code></pre>
<p><img src="21_Intro_IPMs_files/figure-html/unnamed-chunk-10-1.png" /><!-- --></p>
<p>So what did the outer function just do to make the kernel? the way we’ve used it, it takes all pairwise combinations of the the first argument (y) with the second (also y), and does some operation to those combinations. Here are a few examples:</p>
<pre class="r"><code>tmp1=outer(y,y,&#39;+&#39;)
image(y,y,t(tmp1))</code></pre>
<p><img src="21_Intro_IPMs_files/figure-html/unnamed-chunk-11-1.png" /><!-- --></p>
<pre class="r"><code>tmp2=outer(y,y,&#39;*&#39;)
image(y,y,t(tmp2))</code></pre>
<p><img src="21_Intro_IPMs_files/figure-html/unnamed-chunk-11-2.png" /><!-- --></p>
<pre class="r"><code>tmp3=outer(y,exp(y),&#39;+&#39;)
image(y,exp(y),t(tmp3))</code></pre>
<p><img src="21_Intro_IPMs_files/figure-html/unnamed-chunk-11-3.png" /><!-- --> In the IPM case, the operation that we want is not a simple ‘+’ or ’*‘, but the slightly more complicated growth function, given in the third argument (g.yx). to use the growth function, we need to specify the regression coefficients, so the fourth argument supplies the list ’params’ that we defined above, which aer passed to g.yx.</p>
<p><br></p>
<hr />
<p><br></p>
</div>
<div id="population-summaries" class="section level1">
<h1><span class="header-section-number">6</span> Population Summaries</h1>
<p>Analyses usually begin with obtaining the eigenvalues (λ) and eigenvectors (v-left; w-right) of the matrix. These are useful for understanding the asymptotic dynamics. The dominant eigenvalue gives the asymptotic population growth rate (lam). The right eigenvector gives the stable stage distribution and the left eigenvector gives the reproductive value, when normalized.</p>
<pre class="r"><code># 1. get lamda,v,w  
(lam=Re(eigen(K)$values[1])) # should be 1.013391</code></pre>
<pre><code>## [1] 1.013391</code></pre>
<pre class="r"><code>w.eigen=Re(eigen(K)$vectors[,1])
stable.dist=w.eigen/sum(w.eigen) 
v.eigen=Re(eigen(t(K))$vectors[,1])
repro.val=v.eigen/v.eigen[1] 


# The eigen-things can be combined to obtain the sensitivity and elasticity matrices.
# 2. compute elasticity and sensitivity matrices
v.dot.w=sum(stable.dist*repro.val)*h
sens=outer(repro.val,stable.dist)/v.dot.w
elas=matrix(as.vector(sens)*as.vector(K)/lam,nrow=n)

# 3. plot results 

par(mfrow=c(2,3)) 
image(y,y,t(K), xlab=&quot;Size (t)&quot;,ylab=&quot;Size (t+1)&quot;,col=topo.colors(100), main=&quot;Kernel&quot;)
contour(y,y,t(K), add = TRUE, drawlabels = TRUE)
plot(y,stable.dist,xlab=&quot;Size&quot;,type=&quot;l&quot;,main=&quot;Stable size distribution&quot;)
plot(y,repro.val,xlab=&quot;Size&quot;,type=&quot;l&quot;,main=&quot;Reproductive values&quot;) 
image(y,y,t(elas),xlab=&quot;Size (t)&quot;,ylab=&quot;Size (t+1)&quot;,main=&quot;Elasticity&quot;)
image(y,y,t(sens),xlab=&quot;Size (t)&quot;,ylab=&quot;Size (t+1)&quot;, main=&quot;Sensitivity&quot;)</code></pre>
<p><img src="21_Intro_IPMs_files/figure-html/unnamed-chunk-12-1.png" /><!-- --></p>
<p><br></p>
<hr />
<p><br></p>
</div>
<div id="links-to-species-ranges" class="section level1">
<h1><span class="header-section-number">7</span> Links to Species’ Ranges</h1>
<div>
<object data="21_assets/Range_IPMs_Short.pdf" type="application/pdf" width="100%" height="650px">
<p>
It appears you don’t have a PDF plugin for this browser. No biggie… you can <a href="21_assets/Range_IPMs_Short.pdf">click here to download the PDF file.</a>
</p>
</object>
</div>
<p>Thus far we have fit vital rate models (growth, survival, fecundity) assuming that all individuals experience the same environmental conditions. These models use environmental coavariates in the vital rate regressions to characterize environmental conditions. Using GIS information on how environmental conditions vary across a landscape allows you to predict the vital rates across the landscape and build population models there.</p>
<p>Linked below are some more advanced exercises that reproduce a simplified version of the analysis from my paper on garlic mustard invasion in the northeast US.</p>
<p>
<a href="21_assets/Range_IPMs_demo.zip.pdf">Download the demo code</a>
</p>
<!-- ## Colophon -->
</div>


<!-- give the footer some space -->
<br/>
<br/>

<footer id="site-footer">
  <div id="footer1">
  <a href="https://cmerow.github.io"><img src="img/cory.png" alt="logo" width=40px></a>
  <!--
  <a href="http://adamwilson.us/#contact"><i class="fa fa-envelope fa-2x"></i></a> 
  <a href="https://twitter.com/AdamWilsonLab"><i class="fa fa-twitter fa-2x"></i></a> 
  <a href="https://github.com/AdamMWilson"><i class="fa fa-github fa-2x"></i></a>
  -->
  </div>
  <div id="footer2">
  <a rel="license" property="http://creativecommons.org/ns#license"
  href="http://creativecommons.org/licenses/by/4.0/" ><img src="img/cc-by.svg" alt="cc-by"/></a> 
  </div>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
